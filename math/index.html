<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Math Worksheet</title>

<style>
@page { size: A4; margin: 20mm; }

body {
  font-family: Arial, sans-serif;
  font-size: 22px;
}

h2 {
  text-align: center;
}

.container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

.exercise {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 3px 0;
}

.exercise span {
  width: 28px;
  text-align: center;
}

.exercise input {
  width: 60px;
  font-size: 20px;
  text-align: center;
  margin-left: 6px;
}

.correct { background-color: #b6f5b6; }
.wrong { background-color: #f7b1b1; }

.times {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  margin-top: 10px;
  font-size: 18px;
  text-align: center;
}

#submitBtn {
  display: none;
  margin: 25px auto 0;
  font-size: 20px;
  padding: 10px 24px;
  display: block;
}
</style>
</head>

<body>

<h2>Math Worksheet</h2>

<div class="container" id="worksheet"></div>

<div class="times">
  <div id="time0">Time: 00:00</div>
  <div id="time1">Time: 00:00</div>
  <div id="time2">Time: 00:00</div>
  <div id="time3">Time: 00:00</div>
</div>

<button id="submitBtn" onclick="sendEmail()">SUBMIT</button>

<script>
const exercises = [];
const container = document.getElementById("worksheet");

const columnTimers = [
  { start: null, interval: null, done: false },
  { start: null, interval: null, done: false },
  { start: null, interval: null, done: false },
  { start: null, interval: null, done: false }
];

function formatTime(ms) {
  const s = Math.floor(ms / 1000);
  return `${String(Math.floor(s / 60)).padStart(2,'0')}:${String(s % 60).padStart(2,'0')}`;
}

function startTimer(col) {
  if (columnTimers[col].start !== null) return;
  columnTimers[col].start = Date.now();
  columnTimers[col].interval = setInterval(() => {
    const elapsed = Date.now() - columnTimers[col].start;
    document.getElementById("time" + col).innerText =
      "Time: " + formatTime(elapsed);
  }, 500);
}

function stopTimer(col) {
  if (columnTimers[col].done) return;
  columnTimers[col].done = true;
  clearInterval(columnTimers[col].interval);
}

function addExercise(a, op, b, col) {
  let result;
  if (op === "+") result = a + b;
  if (op === "-") result = a - b;
  if (op === "×") result = a * b;
  if (op === "÷") result = a / b;

  exercises.push({ text: `${a} ${op} ${b} =`, result, col });

  const div = document.createElement("div");
  div.className = "exercise";
  div.innerHTML = `
    <span>${a}</span>
    <span>${op}</span>
    <span>${b}</span>
    <span>=</span>
    <input type="number">
  `;
  container.appendChild(div);

  const input = div.querySelector("input");

  input.addEventListener("input", () => {
    startTimer(col);

    input.className =
      Number(input.value) === result ? "correct" : "wrong";

    const colDone = exercises
      .map((e, i) => ({ e, i }))
      .filter(x => x.e.col === col)
      .every(x =>
        Number(document.querySelectorAll("input")[x.i].value) === x.e.result
      );

    if (colDone) stopTimer(col);

    // Show submit after FIRST column is finished
    document.getElementById("submitBtn").style.display =
      columnTimers.some(t => t.done) ? "block" : "none";
  });
}

// Generate exercises
for (let i = 0; i < 28 * 4; i++) {
  const col = i % 4;
  const ops = ["+", "-", "×", "÷"];
  const op = ops[Math.floor(Math.random() * 4)];
  let a, b;

  if (op === "+" || op === "-") {
    a = Math.floor(Math.random() * 90) + 10;
    b = Math.floor(Math.random() * 90) + 1;
    if (op === "-" && b > a) [a, b] = [b, a];
  } else {
    b = Math.floor(Math.random() * 10) + 1;
    a = Math.floor(Math.random() * 10) + 1;
    if (op === "÷") a = a * b;
  }

  addExercise(a, op, b, col);
}

function sendEmail() {
  let body = "Math Worksheet Results\n\n";

  exercises.forEach((ex, i) => {
    body += `${ex.text} ${document.querySelectorAll("input")[i].value || ""}\n`;
  });

  body += "\nTimes:\n";
  columnTimers.forEach((t, i) => {
    body += `Column ${i + 1}: ${document.getElementById("time" + i).innerText}\n`;
  });

  const mailto =
    "mailto:youremail@email.com" +
    "?subject=" + encodeURIComponent("Math Worksheet Results") +
    "&body=" + encodeURIComponent(body);

  window.location.href = mailto;
}
</script>

</body>
</html>
